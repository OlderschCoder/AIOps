{
  "__inputs": [
    { "name": "DS_INFLUXDB", "label": "InfluxDB", "type": "datasource", "pluginId": "influxdb", "pluginName": "InfluxDB" }
  ],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.x" },
    { "type": "datasource", "id": "influxdb", "name": "InfluxDB", "version": "2.x" },
    { "type": "panel", "id": "stat", "name": "Stat", "version": "8.0" },
    { "type": "panel", "id": "timeseries", "name": "Time series", "version": "8.0" },
    { "type": "panel", "id": "table", "name": "Table", "version": "8.0" }
  ],
  "title": "SCCC FortiGate (Fortigate1-Sccc)",
  "timezone": "browser",
  "schemaVersion": 37,
  "style": "dark",
  "tags": ["LCARS", "FortiGate", "Firewall"],
  "templating": { "list": [] },
  "time": { "from": "now-24h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "WAN Upload (bps)",
      "gridPos": { "h": 5, "w": 8, "x": 0, "y": 0 },
      "fieldConfig": { "defaults": { "unit": "bps" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "from(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"interface\")\n  |> filter(fn: (r) => r.sysName == \"Fortigate1-Sccc\")\n  |> filter(fn: (r) => r._field == \"ifOutOctets\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: r._value * 8.0 }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> last()"
        }
      ]
    },
    {
      "type": "stat",
      "title": "WAN Download (bps)",
      "gridPos": { "h": 5, "w": 8, "x": 8, "y": 0 },
      "fieldConfig": { "defaults": { "unit": "bps" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "from(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"interface\")\n  |> filter(fn: (r) => r.sysName == \"Fortigate1-Sccc\")\n  |> filter(fn: (r) => r._field == \"ifInOctets\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: r._value * 8.0 }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> last()"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "FortiGate WAN Throughput (bps)",
      "gridPos": { "h": 9, "w": 24, "x": 0, "y": 5 },
      "fieldConfig": { "defaults": { "unit": "bps" } },
      "options": { "legend": { "displayMode": "table" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "from(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"interface\")\n  |> filter(fn: (r) => r.sysName == \"Fortigate1-Sccc\")\n  |> filter(fn: (r) => r._field == \"ifInOctets\" or r._field == \"ifOutOctets\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: r._value * 8.0, dir: if r._field == \"ifInOctets\" then \"download\" else \"upload\" }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"wan_bps\")"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Sessions (placeholder)",
      "gridPos": { "h": 5, "w": 8, "x": 16, "y": 0 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "// populate via SNMP fgSysSesCount\nfrom(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"snmp\")\n  |> filter(fn: (r) => r._field == \"fgSysSesCount\")\n  |> aggregateWindow(every: v.windowPeriod, fn: last, createEmpty: false)\n  |> last()"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "CPU / Memory (placeholder)",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "fieldConfig": { "defaults": { "unit": "percent" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        { "refId": "A", "queryType": "flux", "query": "from(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"snmp\")\n  |> filter(fn: (r) => r._field == \"fgSysCpuUsage\" or r._field == \"fgSysMemUsage\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)" }
      ]
    },
    {
      "type": "table",
      "title": "Intrusions / Denies (placeholder)",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        { "refId": "A", "queryType": "flux", "query": "// FortiGate syslog parsed inline from message field\nfrom(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"syslog\")\n  |> filter(fn: (r) => r._field == \"message\")\n  |> map(fn: (r) => ({ r with action: if exists r._value and r._value =~ /action=deny|action=blocked/ then \"deny\" else \"other\" }))\n  |> map(fn: (r) => ({ r with subtype: if exists r._value and r._value =~ /subtype=ips|eventtype=ips/ then \"ips\" else \"other\" }))\n  |> filter(fn: (r) => r.action == \"deny\" or r.subtype == \"ips\")\n  |> aggregateWindow(every: v.windowPeriod, fn: count, createEmpty: false)\n  |> group(columns: [\"action\", \"subtype\"])\n  |> sum(column: \"_value\")" }
      ],
      "description": "If logs arenâ€™t in Influx, point this panel to Loki/Elastic instead."
    }
  ]
}



