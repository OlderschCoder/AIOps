{
  "__inputs": [
    { "name": "DS_INFLUXDB", "label": "InfluxDB", "type": "datasource", "pluginId": "influxdb", "pluginName": "InfluxDB" }
  ],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.x" },
    { "type": "datasource", "id": "influxdb", "name": "InfluxDB", "version": "2.x" },
    { "type": "panel", "id": "timeseries", "name": "Time series", "version": "8.0" },
    { "type": "panel", "id": "stat", "name": "Stat", "version": "8.0" },
    { "type": "panel", "id": "table", "name": "Table", "version": "8.0" }
  ],
  "title": "SCCC Wireless Network (LCARS)",
  "timezone": "browser",
  "schemaVersion": 37,
  "style": "dark",
  "tags": ["LCARS", "Wireless"],
  "templating": {
    "list": [
      { "type": "custom", "name": "buildingGroup", "query": "Dorms,Cafeteria,Library,Admin,Science,Gym,Theater", "includeAll": true, "multi": true },
      { "type": "interval", "name": "interval", "query": "1m,5m,10m,30m,1h", "current": { "text": "5m", "value": "5m" } }
    ]
  },
  "time": { "from": "now-24h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "Total Clients (placeholder)",
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 0 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "// Populate from wireless controller export to measurement 'wireless' field 'clients_total'\nfrom(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"wireless\" and r._field == \"clients_total\")\n  |> aggregateWindow(every: v.interval, fn: last, createEmpty: false)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Clients by Building Group (placeholder)",
      "gridPos": { "h": 9, "w": 18, "x": 6, "y": 0 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "options": { "legend": { "displayMode": "table" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "from(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"wireless\" and r._field == \"clients_total\")\n  |> filter(fn: (r) => contains(value: r.building_group, set: v.buildingGroup))\n  |> aggregateWindow(every: v.interval, fn: mean, createEmpty: false)\n  |> group(columns: [\"building_group\"])\n  |> yield(name: \"clients_by_group\")"
        }
      ],
      "description": "Requires building_group tag in wireless measurement."
    },
    {
      "type": "timeseries",
      "title": "Channel Utilization / Noise (placeholder)",
      "gridPos": { "h": 9, "w": 24, "x": 0, "y": 9 },
      "fieldConfig": { "defaults": { "unit": "percent" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "// Populate from controller metrics: channel_utilization, noise_floor\nfrom(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"wireless\" and (r._field == \"channel_utilization\" or r._field == \"noise_floor\"))\n  |> aggregateWindow(every: v.interval, fn: mean, createEmpty: false)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Dorms vs Cafeteria Daily Pattern (placeholder)",
      "gridPos": { "h": 9, "w": 24, "x": 0, "y": 18 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "queryType": "flux",
          "query": "// Example compare Dorms vs Cafeteria\nfrom(bucket: \"telegraf\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"wireless\" and r._field == \"clients_total\")\n  |> filter(fn: (r) => r.building_group == \"Dorms\" or r.building_group == \"Cafeteria\")\n  |> aggregateWindow(every: v.interval, fn: mean, createEmpty: false)"
        }
      ]
    }
  ]
}


